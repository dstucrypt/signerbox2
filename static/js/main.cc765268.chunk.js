(this.webpackJsonpsignerbox2=this.webpackJsonpsignerbox2||[]).push([[0],{136:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(80),c=n.n(o),i=(n(88),n(3)),l=n(8),u=n(9),s=n(11),f=n(10),h=n(19),m=(n(89),n(5)),d=n(35),p=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleFile=a.handleFile.bind(Object(m.a)(a)),a}return Object(u.a)(n,[{key:"handleFile",value:function(e){var t=Object(h.a)(e.target.files,1)[0];return t?Object(d.a)(t).then(this.props.onAdd):null}},{key:"render",value:function(){return r.a.createElement("form",null,"Select file to sign:",r.a.createElement("input",{type:"file",name:"fileselect",value:"",onChange:this.handleFile}))}}]),n}(a.Component),v=n(37),b=n(4),y=n.n(b),g=n(27);function j(e){var t=e[e.length-1];return Boolean(128&t)}function k(e){var t=e[e.length-1];return Boolean(4&t)}function O(e){return e&&("IIT"===e.format||"jks-key"===e.format||"PBES2"===e.format)}function w(e){return e&&"Priv"===e.type}function E(e){return e&&"x509"===e.format&&j(e.extension.keyUsage)}function S(e){return e.filter(E)[0]||null}function P(e){return e.reduce((function(e,t){return t?Array.isArray(t)?[].concat(Object(i.a)(e),Object(i.a)(P(t))):t.material?[].concat(Object(i.a)(e),Object(i.a)(function(e){return e.reduce((function(e,t){if(!t)return e;if(t.key&&t.certs){var n=t.certs.map((function(e){return y.a.Certificate.from_asn1(e)}));e=[].concat(Object(i.a)(e),Object(i.a)(n),[{format:"jks-key",contents:t.key,name:t.name,match:S(n)}])}return e}),[])}(t.material))):"IIT"===t.format||"x509"===t.format||"PBES2"===t.format?[].concat(Object(i.a)(e),[t]):"privkeys"===t.format?[].concat(Object(i.a)(e),Object(i.a)(t.keys)):e:e}),[])}var C=function(e){return Promise.all(Array.prototype.map.call(e,(function(e){return Object(d.a)(e).then((function(e){return function(e){return e.name.endsWith(".jks")}(e)?Object(v.a)({},e,{},Object(g.parse)(e.contents)):y.a.guess_parse(e.contents)})).catch((function(e){return console.error(e)}))}))).then(P)},x=n(18),A=n.n(x);var I=function(e,t){return"jks-key"===e.format?Object(g.decode)(e.contents,t):"IIT"===e.format||"PBES2"===e.format?A.a.compat.algos().storeload(e,t):null},B=n(17),F=n.n(B),_=n(36);function T(e){var t=F.a.TimeStampResp.decode(e,"der");if("granted"===t.status.status)return t=F.a.TSTInfo.decode(t.timeStampToken.content.contentInfo.content),console.log("resp body",t),e.slice(9);console.log("oops")}var N=function(e,t){var n=F.a.TimeStampReq.encode({version:1,messageImprint:{hashAlgorithm:{algorithm:"Gost34311"},hashedMessage:t}},"der");return Object(_.a)("https://cors-anywhere.herokuapp.com/"+e.extension.tsp,n).then(T)},U=A.a.compat.algos();function K(e,t,n){var a=U.hash(n);return N(t,a).catch((function(){return null})).then((function(r){return function(e,t,n,a,r){return new y.a.models.Message({type:"signedData",cert:t.contents?y.a.models.Certificate.from_asn1(t.contents):t,data:n,dataHash:a,tspB:r,signer:e,hash:U.hash}).as_asn1()}(e,t,n,a,r)}))}var W=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={password:"",error:null,keyIdx:0},a.handleFile=a.handleFile.bind(Object(m.a)(a)),a.handlePassword=a.handlePassword.bind(Object(m.a)(a)),a.handleOpen=a.handleOpen.bind(Object(m.a)(a)),a.handleSelectKey=a.handleSelectKey.bind(Object(m.a)(a)),a.handleSign=a.handleSign.bind(Object(m.a)(a)),a}return Object(u.a)(n,[{key:"handleFile",value:function(e){var t=this;C(e.target.files).then((function(e){t.props.onAdd(e)}))}},{key:"handleOpen",value:function(e){var t=this;e.preventDefault();var n=this.state,a=n.password,r=n.keyIdx,o=this.props.material,c=(o||[]).filter(O)[r||0],l=I(c,a);l?(this.setState({error:null,password:""}),C([Object(v.a)({name:"dat"},c,{contents:l})]).then((function(e){t.props.onAdd([].concat(Object(i.a)(o),Object(i.a)(e)))}))):this.setState({error:"EPASSWORD"})}},{key:"handleSelectKey",value:function(e){this.setState({keyIdx:Number(e.target.value)})}},{key:"handlePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleSign",value:function(e){e.preventDefault();var t=(this.props.material||[]).filter((function(e){return w(e)&&E(e.match)})),n=Object(h.a)(t,1)[0];this.props.onSign(K.bind(null,n,n.match))}},{key:"render",value:function(){var e=this.state,t=e.password,n=e.error,a=this.props.material,o=(a||[]).filter(O),c=(a||[]).filter((function(e){return w(e)&&E(e.match)})),i=Object(h.a)(c,1)[0];return c.length>1?r.a.createElement("div",null,"Signing keys found: ",c.length):1===c.length?r.a.createElement("div",null,r.a.createElement("button",{onClick:this.handleSign},"Sign as ",i.match.subject.title," ",i.match.subject.commonName)):r.a.createElement("div",null,!o.length&&r.a.createElement("div",null,"Select private key:",r.a.createElement("input",{type:"file",multiple:!0,name:"keyselect",value:"",onChange:this.handleFile})),o.length>0&&r.a.createElement("form",{onSubmit:this.handleOpen},o.length>1&&r.a.createElement("select",{onChange:this.handleSelectKey},o.map((function(e,t){return r.a.createElement("option",{value:t,key:t},e.match&&e.match.subject?(e.match.subject.title||"")+" "+(e.match.subject.commonName||""):e.name||t)}))),"Password:",r.a.createElement("input",{type:"password",name:"password",value:t,onChange:this.handlePassword,autoFocus:!0}),n),r.a.createElement("div",null,"Found keys: ",o.length))}}]),n}(a.Component);function M(e,t){!function(e,t){var n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}("data:application/octet-stream;base64,"+Object(b.b64_encode)(e),t)}var R=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleSave=a.handleSave.bind(Object(m.a)(a)),a}return Object(u.a)(n,[{key:"handleSave",value:function(e){e.preventDefault();var t=this.props.file;M(t._raw||t.to_asn1(),t.name||(t.type||t.format)+".dat")}},{key:"render",value:function(){var e=this.props,t=e.file,n=e.children;return t.to_asn1||t._raw?r.a.createElement("span",null,n," (",r.a.createElement("button",{role:"link",onClick:this.handleSave},"save file"),")"):n}}]),n}(a.Component),D=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.format,o=e.subject,c=e.extension,i=e.name,l=e.match;return o?r.a.createElement("span",null,a," ",o.title," ",o.commonName," ",j(c.keyUsage)&&"SIGN"," ",function(e){var t=e[e.length-1];return Boolean(8&t)}(c.keyUsage)&&"ENC"," ",k(c.keyUsage)&&"CA"):"jks-key"===a&&l?r.a.createElement("span",null,"Encrypted Key ",i," for ",r.a.createElement(n,l)):"IIT"===a||"jks-key"===a||"PBES2"===a?r.a.createElement("span",null,"Encrypted Key ",i):a?r.a.createElement("span",null,a," ?"):"Priv"===t&&l?r.a.createElement("span",null,"Private key for ",r.a.createElement(n,l)):"Priv"===t?r.a.createElement("span",null,"Private key without match"):null}}]),n}(a.Component),L=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.value;return e?r.a.createElement("div",null,"Key Material and Certificates",r.a.createElement("ul",null,e.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(R,{file:e},r.a.createElement(D,e)))})))):null}}]),n}(a.Component);function q(e){return e.map((function(t){var n,a;return t.match=(a=e,"jks-key"===(n=t).format&&n.match?n.match:"Priv"!==n.type?null:a.reduce((function(e,t){return e||("x509"!==t.format||k(t.extension.keyUsage)||!t.extension.ipn?e:(t.pubkey_unpack&&t.pubkey_unpack(),n.pub_match(t.pubkey)?t:e))}),null)),t}))}var G=n(81);var J={file:null,material:[]},H=new Proxy({title:"Signerbox2"},J),X=function(e){Object(s.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),a=t.call(this,e),J.set=function(e,t,n){return e[t]=n,a.forceUpdate(),!0},a}return Object(u.a)(n,[{key:"handleAdd",value:function(e){H.material=q(e),function(e){var t=e.filter((function(e){return"Priv"===e.type&&!e.match})),n=Object(h.a)(t,2),a=n[0],r=n[1];return a?Object(G.a)([a,r]):Promise.reject()}(H.material).then((function(e){e&&(H.material=q([].concat(Object(i.a)(H.material),Object(i.a)(e))))})).catch((function(){return null}))}},{key:"handleFile",value:function(e){H.file=e}},{key:"handleSign",value:function(e){e(H.file.contents).then((function(e){return M(e,H.file.name+".p7s")}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},H.title,H.file?r.a.createElement("p",null,'Signing file "',H.file.name,'"'):r.a.createElement(p,{onAdd:this.handleFile}),H.file&&r.a.createElement(W,{material:H.material,onAdd:this.handleAdd,onSign:this.handleSign}),r.a.createElement(L,{value:H.material}))}}]),n}(a.Component),$=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(X,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/signerbox2",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/signerbox2","/service-worker.js");$?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):z(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):z(e)}))}}()},35:function(e,t,n){"use strict";(function(e){function a(t){if(t.contents)return Promise.resolve(t);var n=new FileReader;return new Promise((function(a,r){n.onload=function(n){return a({name:t.name,contents:new e(n.target.result)})},n.onerror=r,n.readAsArrayBuffer(t)}))}n.d(t,"a",(function(){return a}))}).call(this,n(1).Buffer)},36:function(e,t,n){"use strict";(function(e){t.a=function(t,n,a){return fetch(t,{body:n,method:"POST",mode:"cors",headers:{"X-Requested-With":null}}).then((function(e){return e.arrayBuffer()})).then((function(t){return new e(new Uint8Array(t))}))}}).call(this,n(1).Buffer)},81:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var a=n(4),r=n(18),o=n.n(r),c=n(36),i=n(82),l=n.n(i);function u(e){var t;try{t=new a.models.Message(e)}catch(n){return null}return t.info?1!==t.info.readInt32LE(4)?null:(t=new a.models.Message(t.info.slice(8))).info.certificate.map((function(e){return new a.models.Certificate(e,!0)})):null}var s=["http://masterkey.ua/services/cmp/","https://ca.informjust.ua/services/cmp/","http://acskidd.gov.ua/services/cmp/"];function f(t){var n=function(t){var n=o.a.compat.algos(),r=t.map((function(e){return e&&e.pub().keyid(n)})),c=new e(120);return c.fill(0),r[0].copy(c,12),(r[1]||r[0]).copy(c,44),c[108]=1,c[112]=1,c[8]=2,c[0]=13,new a.models.Message({type:"data",data:c}).as_asn1()}(t);return l()(s.map((function(e){return function(e,t){return Object(c.a)("https://cors-anywhere.herokuapp.com/"+t,e)}(n,e).then(u).then((function(e){return e||Promise.reject()}))})))}}).call(this,n(1).Buffer)},82:function(e,t){function n(e){return new Promise((function(t,n){return e.then(n,t)}))}e.exports=function(e){return n(Promise.all(e.map(n)))}},83:function(e,t,n){e.exports=n(136)},88:function(e,t,n){},89:function(e,t,n){},97:function(e,t){}},[[83,1,2]]]);
//# sourceMappingURL=main.cc765268.chunk.js.map