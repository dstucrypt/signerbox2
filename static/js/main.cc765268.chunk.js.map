{"version":3,"sources":["FileSelect.js","utils.js","reader.js","opener.js","tsp.js","sign.js","KeySelect.js","save.js","Material.js","match.js","App.js","registerServiceWorker.js","index.js","filereader.js","post.js","certfetch.js","race.js"],"names":["FileSelect","props","handleFile","bind","event","file","target","files","readFile","then","this","onAdd","type","name","value","onChange","Component","canSign","data","lastByte","length","Boolean","isCA","isKey","format","isOpen","isSigning","extension","keyUsage","selectSigning","certs","filter","flattenMaterial","material","reduce","acc","Array","isArray","key","map","contents","jkurwa","Certificate","from_asn1","match","flattenJks","keys","read","Promise","all","prototype","call","endsWith","isJks","parseJks","guess_parse","catch","err","console","error","open","password","decodeJks","gost89","compat","algos","storeload","parse","rtsp","rfc3161","TimeStampResp","decode","status","TSTInfo","timeStampToken","content","contentInfo","log","slice","makeTsp","cert","hash","tsp","TimeStampReq","encode","version","messageImprint","hashAlgorithm","algorithm","hashedMessage","post","algo","sign","dataHash","tspB","models","Message","signer","as_asn1","signHelper","KeySelect","state","keyIdx","handlePassword","handleOpen","handleSelectKey","handleSign","preventDefault","setState","more","Number","onSign","signKeys","firstKey","onClick","subject","title","commonName","multiple","onSubmit","idx","autoFocus","save","blob","url","filename","link","document","createElement","href","download","body","appendChild","click","removeChild","clickLink","b64_encode","Saveable","handleSave","_raw","to_asn1","children","role","Part","canEnc","Material","part","makeMatches","other","ipn","pubkey_unpack","pub_match","pubkey","handler","Proxy","App","set","forceUpdate","key1","key2","certfetch","reject","fetchMissing","certificates","signFn","signedContents","className","handleAdd","isLocalhost","window","location","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","getElementById","URL","process","origin","addEventListener","fetch","response","headers","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","resolve","reader","FileReader","onload","Buffer","result","onerror","readAsArrayBuffer","queryUrL","cb","method","mode","res","arrayBuffer","Uint8Array","resp","rmsg","e","info","readInt32LE","certificate","certData","URLS","payload","keyids","priv","pub","keyid","ct","fill","copy","query","raceToSuccess","invertPromise","promise","module","exports","promises"],"mappings":"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","file":"static/js/main.cc765268.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport {readFile} from './filereader';\n\nclass FileSelect extends Component {\n  constructor(props) {\n    super(props);\n    this.handleFile = this.handleFile.bind(this);\n  }\n\n  handleFile(event) {\n    const [file] = event.target.files;\n    if (!file) {\n      return null;\n    }\n    return readFile(file)\n    .then(this.props.onAdd);\n  }\n\n  render() {\n    return (<form>\n      Select file to sign:\n        <input\n          type=\"file\"\n          name=\"fileselect\"\n          value=\"\"\n          onChange={this.handleFile} />\n    </form>);\n  }\n}\n\nexport default FileSelect;\n","// TO BE MOVED into JK codebase\n// Key usage bitmask (inverted):\n// digital signature 0\n// non repudiation 1\n// key encipherment 2\n// data extension.keyUsage 3\n// key agreement 4\n// ca key 5\n// crl key 6\n// encipher only 7\n// decipher only 8\n\nfunction canSign(data) {\n  const lastByte = data[data.length - 1];\n  return Boolean(lastByte & 0x80);\n}\n\nfunction canEnc(data) {\n  const lastByte = data[data.length - 1];\n  return Boolean(lastByte & (0x80 >> 4));\n}\n\nfunction isCA(data) {\n  const lastByte = data[data.length - 1];\n  return Boolean(lastByte & (0x80 >> 5));\n}\n\nfunction isKey(file) {\n  return file && (file.format === 'IIT' || file.format === 'jks-key' || file.format === 'PBES2');\n}\n\nfunction isOpen(file) {\n  return file && file.type === 'Priv';\n}\n\nfunction isSigning(file) {\n  return file && file.format === 'x509' && canSign(file.extension.keyUsage);\n}\n\nfunction isJks(file) {\n  return file.name.endsWith('.jks');\n}\n\nexport {canSign, canEnc, isCA, isKey, isOpen, isSigning, isJks};\n","import jkurwa from 'jkurwa';\nimport {parse as parseJks} from 'jksreader';\nimport {isSigning, isJks} from './utils';\nimport {readFile} from './filereader';\n\nfunction selectSigning(certs) {\n  return certs.filter(isSigning)[0] || null;\n}\n\nfunction flattenJks(material) {\n  return material.reduce((acc, file)=> {\n    if (!file) {\n      return acc;\n    }\n    if (file.key && file.certs) {\n      const certs = file.certs.map((contents)=> jkurwa.Certificate.from_asn1(contents));\n      acc = [...acc, ...certs, {format: 'jks-key', contents: file.key, name: file.name, match: selectSigning(certs)}];\n    }\n\n    return acc;\n  }, []);\n}\n\nfunction flattenMaterial(material) {\n  return material.reduce((acc, file)=> {\n    if (!file) {\n      return acc;\n    }\n    if (Array.isArray(file)) {\n      return [...acc, ...flattenMaterial(file)];\n    }\n    if (file.material) {\n      return [...acc, ...flattenJks(file.material)];\n    }\n    if (file.format === 'IIT' || file.format === 'x509' || file.format === 'PBES2') {\n      return [...acc, file];\n    }\n    if (file.format === 'privkeys') {\n      return [...acc, ...file.keys];\n    }\n\n    return acc;\n  }, []);\n}\n\n\nfunction read(files) {\n  return Promise.all(\n    Array.prototype.map.call(files, (file)=> {\n      return readFile(file)\n        .then(file=> isJks(file)\n            ? ({...file, ...parseJks(file.contents)})\n            : jkurwa.guess_parse(file.contents)\n        )\n        .catch((err)=> console.error(err));\n    })\n  )\n  .then(flattenMaterial);\n}\nexport default read;\n","import gost89 from 'gost89';\nimport {decode as decodeJks} from 'jksreader';\n\nfunction open(file, password) {\n  if (file.format === 'jks-key') {\n    return decodeJks(file.contents, password);\n  }\n  if (file.format === 'IIT' || file.format === 'PBES2') {\n    const algo = gost89.compat.algos();\n    return algo.storeload(file, password);\n  }\n\n  return null;\n}\n\nexport default open;\n","import rfc3161 from 'jkurwa/lib/spec/rfc3161-tsp';\nimport post from './post';\n\nfunction parse(data) {\n  let rtsp = rfc3161.TimeStampResp.decode(data, 'der');\n  if (rtsp.status.status !== 'granted') {\n    console.log('oops');\n    return;\n  }\n  rtsp = rfc3161.TSTInfo.decode(rtsp.timeStampToken.content.contentInfo.content);\n  console.log('resp body', rtsp);\n  return data.slice(9);\n}\n\nfunction makeTsp(cert, hash) {\n  const tsp = rfc3161.TimeStampReq.encode({\n    version: 1,\n    messageImprint: {\n      hashAlgorithm: {\n        algorithm: 'Gost34311',\n      },\n      hashedMessage: hash,\n    },\n  }, 'der');\n\n  return post('https://cors-anywhere.herokuapp.com/' + cert.extension.tsp, tsp)\n  .then(parse)\n\n}\n\nexport default makeTsp;\n","import jkurwa from 'jkurwa';\nimport gost89 from 'gost89';\nimport makeTsp from './tsp';\n\nconst algo = gost89.compat.algos();\n\nfunction signHelper(key, cert, data, dataHash, tspB) {\n  const msg = new jkurwa.models.Message({\n      type: 'signedData',\n      cert: cert.contents\n          ? jkurwa.models.Certificate.from_asn1(cert.contents)\n          : cert,\n      data,\n      dataHash,\n      tspB,\n      signer: key,\n      hash: algo.hash,\n  });\n  return msg.as_asn1();\n};\n\nfunction sign(key, cert, data) {\n  const dataHash = algo.hash(data);\n  return makeTsp(cert, dataHash)\n    .catch(()=> null)\n    .then((tspB)=> signHelper(key, cert, data, dataHash, tspB));\n}\n\nexport {sign};\n","import React, { Component } from 'react';\nimport read from './reader';\nimport open from './opener';\n\nimport {isKey, isOpen, isSigning} from './utils';\nimport {sign} from './sign';\n\nexport default class KeySelect extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      password: '',\n      error: null,\n      keyIdx: 0,\n    };\n    this.handleFile = this.handleFile.bind(this);\n    this.handlePassword = this.handlePassword.bind(this);\n    this.handleOpen = this.handleOpen.bind(this);\n    this.handleSelectKey = this.handleSelectKey.bind(this);\n    this.handleSign = this.handleSign.bind(this);\n  }\n\n  handleFile(event) {\n    read(event.target.files)\n    .then((material)=> {\n      this.props.onAdd(material);\n    });\n  }\n\n  handleOpen(event) {\n    event.preventDefault();\n    const {password, keyIdx} = this.state;\n    const {material} = this.props;\n    const key = (material || []).filter(isKey)[keyIdx || 0];\n    const contents = open(key, password);\n    if (contents) {\n      this.setState({error: null, password: ''});\n      read([{name: 'dat', ...key, contents}])\n      .then((more)=> {\n        this.props.onAdd([...material, ...more]);\n      });\n    } else {\n      this.setState({error: 'EPASSWORD'});\n    }\n  }\n\n  handleSelectKey(event) {\n    this.setState({keyIdx: Number(event.target.value)});\n  }\n\n  handlePassword(event) {\n    this.setState({password: event.target.value});\n  }\n\n  handleSign(event) {\n    event.preventDefault();\n    const {material} = this.props;\n    const [key] = (material || []).filter((file)=> isOpen(file) && isSigning(file.match));\n    this.props.onSign(sign.bind(null, key, key.match));\n  }\n\n  render() {\n    const {password, error} = this.state;\n    const {material} = this.props;\n    const keys = (material || []).filter(isKey);\n    const signKeys = (material || []).filter((file)=> isOpen(file) && isSigning(file.match));\n    const [firstKey] = signKeys;\n    if (signKeys.length > 1) {\n      return (<div>Signing keys found: {signKeys.length}</div>);\n    }\n    if (signKeys.length === 1) {\n      return (<div>\n        <button onClick={this.handleSign}>\n          Sign as {firstKey.match.subject.title} {firstKey.match.subject.commonName}\n        </button>\n      </div>);\n    }\n\n    return (<div>\n      {!keys.length && (<div>\n        Select private key:\n        <input\n          type=\"file\"\n          multiple\n          name=\"keyselect\"\n          value=\"\"\n          onChange={this.handleFile} />\n      </div>)}\n\n      {(keys.length > 0) && (<form onSubmit={this.handleOpen}>\n        {(keys.length > 1) && (<select onChange={this.handleSelectKey} >\n          {keys.map((key, idx)=> <option value={idx} key={idx}>\n            {(key.match && key.match.subject)\n              ? (key.match.subject.title || '') + ' ' + (key.match.subject.commonName || '')\n              : (key.name || idx)}\n          </option>)}\n        </select>)}\n        Password:\n        <input type=\"password\" name=\"password\" value={password} onChange={this.handlePassword} autoFocus />\n        {error}\n      </form>)}\n\n      <div>\n        Found keys: {keys.length}\n      </div>\n\n    </div>);\n  }\n}\n","import {b64_encode} from 'jkurwa';\n\nfunction clickLink(url, filename) {\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\nexport default function save(blob, name) {\n    clickLink(\n        'data:application/octet-stream;base64,' + b64_encode(blob),\n        name\n    );\n}\n","import React, { Component } from 'react';\n\nimport {canSign, canEnc, isCA} from './utils';\nimport save from './save';\n\nclass Saveable extends Component {\n  constructor(props) {\n    super(props);\n    this.handleSave = this.handleSave.bind(this);\n  }\n\n  handleSave(event) {\n    event.preventDefault();\n    const {file} = this.props;\n    save(file._raw || file.to_asn1(), file.name || (file.type || file.format) + '.dat');\n  }\n\n  render() {\n    const {file, children} = this.props;\n    return (file.to_asn1 || file._raw)\n      ? (<span>{children} (<button role=\"link\" onClick={this.handleSave}>save file</button>)</span>)\n      : children;\n  }\n}\n\nclass Part extends Component {\n  render() {\n    const {type, format, subject, extension, name, match} = this.props;\n    if (subject) {\n      return (<span>{format} {subject.title} {subject.commonName} {canSign(extension.keyUsage) && 'SIGN'} {canEnc(extension.keyUsage) && 'ENC'} {isCA(extension.keyUsage) && 'CA'}</span>);\n    }\n    if (format === 'jks-key' && match) {\n      return (<span>Encrypted Key {name} for <Part {...match} /></span>);\n    }\n    if (format === 'IIT' || format === 'jks-key' || format === 'PBES2') {\n      return (<span>Encrypted Key {name}</span>);\n    }\n    if (format) {\n      return (<span>{format} ?</span>);\n    }\n    if (type === 'Priv' && match) {\n      return (<span>Private key for <Part {...match} /></span>);\n    }\n    if (type === 'Priv') {\n      return (<span>Private key without match</span>);\n    }\n\n    return null;\n  }\n}\n\nclass Material extends Component {\n  render() {\n    const {value} = this.props;\n    if (!value) {\n      return null;\n    }\n    return (<div>\n      Key Material and Certificates\n      <ul>\n        {value.map((part, idx)=>\n          <li key={idx}><Saveable file={part}><Part {...part} /></Saveable></li>\n        )}\n      </ul>\n    </div>);\n  }\n}\n\nexport default Material;\n","import {isCA} from './utils';\n\nfunction findMatch(key, other) {\n  if (key.format === 'jks-key' && key.match) {\n    return key.match;\n  }\n  if (key.type !== 'Priv') {\n    return null;\n  }\n  return other.reduce((acc, file)=> {\n    if (acc) {\n      return acc;\n    }\n    if (file.format !== 'x509') {\n      return acc;\n    }\n    if (isCA(file.extension.keyUsage) || !file.extension.ipn) {\n      return acc;\n    }\n\n    file.pubkey_unpack && file.pubkey_unpack();\n    if (key.pub_match(file.pubkey)) {\n      return file;\n    }\n    return acc;\n  }, null);\n}\n\nfunction makeMatches(material) {\n  return material.map((part)=> {\n    part.match = findMatch(part, material);\n    return part;\n  });\n}\n\nexport {makeMatches};\n","import React, { Component } from 'react';\nimport './App.css';\nimport FileSelect from './FileSelect';\nimport KeySelect from './KeySelect';\nimport Material from './Material';\n\nimport {makeMatches} from './match';\nimport save from './save';\nimport certfetch from './certfetch';\n\nfunction fetchMissing(material) {\n  const [key1, key2] = material.filter((file)=> (\n    (file.type === 'Priv') && !file.match\n  ));\n  return key1 ? certfetch([key1, key2]) : Promise.reject();\n}\n\nconst handler = {file: null, material: []};\n\nconst state = new Proxy({title: 'Signerbox2'}, handler);\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    handler.set = (target, key, value)=> {\n      target[key] = value;\n      this.forceUpdate();\n      return true;\n    };\n  }\n\n  handleAdd(material) {\n    state.material = makeMatches(material);\n    fetchMissing(state.material)\n    .then((certificates)=> {\n      if (certificates) {\n        state.material = makeMatches([...state.material, ...certificates]);\n      }\n    })\n    .catch(()=> null);\n  }\n\n  handleFile(file) {\n    state.file = file;\n  }\n\n  handleSign(signFn) {\n    signFn(state.file.contents)\n      .then((signedContents)=> save(signedContents, state.file.name + '.p7s'));\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        {state.title}\n        {state.file\n          ? (<p>Signing file \"{state.file.name}\"</p>)\n          : (<FileSelect onAdd={this.handleFile} />)}\n        {state.file && (<KeySelect material={state.material} onAdd={this.handleAdd} onSign={this.handleSign} />)}\n        <Material value={state.material} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n","function readFile(file) {\n  if (file.contents) {\n    return Promise.resolve(file);\n  }\n  const reader = new FileReader();\n  return new Promise((resolve, reject)=> {\n    reader.onload = (event)=> resolve({\n      name: file.name,\n      contents: new Buffer(event.target.result),\n    });\n    reader.onerror = reject;\n    reader.readAsArrayBuffer(file)\n  });\n}\n\nexport {readFile};\n","function post(queryUrL, data, cb) {\n  // X-Requested-With header enables request to work with cors anywhere, details - https://cors-anywhere.herokuapp.com/\n  return fetch(queryUrL, {body: data, method: 'POST', mode: 'cors', headers:{'X-Requested-With': null}})\n  .then((res)=> res.arrayBuffer())\n  .then((res)=> (\n    new Buffer(new Uint8Array(res))\n  ));\n}\n\n\nexport default post;\n","import {models} from 'jkurwa';\nimport gost89 from 'gost89';\nimport post from './post';\nimport raceToSuccess from './race';\n\nfunction query(keys) {\n  const algo = gost89.compat.algos();\n  const keyids = keys.map(function (priv) {\n    return priv && priv.pub().keyid(algo);\n  });\n\n  /* black magic here. blame eeeeeet */\n  const ct = new Buffer(120);\n  ct.fill(0);\n  keyids[0].copy(ct, 0xC);\n  (keyids[1] || keyids[0]).copy(ct, 0x2C);\n  ct[0x6C] = 0x1;\n  ct[0x70] = 0x1;\n  ct[0x08] = 2;\n  ct[0] = 0x0D;\n\n  const msg = new models.Message({type: 'data', data: ct});\n  return msg.as_asn1();\n}\n\nfunction parse(resp) {\n  let rmsg;\n  try {\n    rmsg = new models.Message(resp);\n  }\n  catch (e) {\n    return null\n  }\n\n  if (!rmsg.info) {\n    return null;\n  }\n  const result = rmsg.info.readInt32LE(4);\n  if (result !== 1) {\n      return null;\n  }\n  rmsg = new models.Message(rmsg.info.slice(8));\n  return rmsg.info.certificate.map((certData)=> (\n    new models.Certificate(certData, true)\n  ));\n}\n\nfunction fetch(payload, url) {\n  return post('https://cors-anywhere.herokuapp.com/' + url, payload);\n}\n\nconst URLS = [\n  'http://masterkey.ua/services/cmp/',\n  'https://ca.informjust.ua/services/cmp/',\n  'http://acskidd.gov.ua/services/cmp/'\n];\n\n\nexport default function certfetch(keys) {\n  const payload = query(keys);\n  return raceToSuccess(\n    URLS.map(\n      (url)=> fetch(payload, url)\n        .then(parse)\n        .then((certs)=> certs || Promise.reject())\n    )\n  );\n}\n","function invertPromise(promise) {\n  return new Promise(\n    (resolve, reject) => \n      promise.then(reject, resolve)\n  );\n}\n\nfunction raceToSuccess(promises) {\n  return invertPromise(\n    Promise.all(\n      promises.map(invertPromise)));\n} \n\nmodule.exports = raceToSuccess;\n"],"sourceRoot":""}